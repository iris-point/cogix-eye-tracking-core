<!DOCTYPE html>
<html>
<head>
  <title>Eye Tracker Status Check Example</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f0f0f0;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .status-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 20px 0;
    }
    .status-item {
      padding: 10px;
      background: #f8f8f8;
      border-radius: 4px;
      border-left: 4px solid #ccc;
    }
    .status-item.active {
      border-left-color: #4CAF50;
      background: #f0fff0;
    }
    .status-item.error {
      border-left-color: #f44336;
      background: #fff0f0;
    }
    .status-item.warning {
      border-left-color: #ff9800;
      background: #fffaf0;
    }
    .button-group {
      margin: 20px 0;
    }
    button {
      margin: 5px;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      background: #2196F3;
      color: white;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background: #1976D2;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .log-output {
      background: #f5f5f5;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      height: 200px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 12px;
    }
    .status-label {
      font-weight: bold;
      margin-right: 10px;
    }
    .status-value {
      color: #666;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Eye Tracker Status Check</h1>
    
    <div class="button-group">
      <button id="connectBtn">Connect</button>
      <button id="initDeviceBtn" disabled>Initialize Device</button>
      <button id="initLightBtn" disabled>Initialize Light</button>
      <button id="startCameraBtn" disabled>Start Camera</button>
      <button id="calibrateBtn" disabled>Start Calibration</button>
      <button id="detailsBtn">Get Detailed Status</button>
      <button id="disconnectBtn" disabled>Disconnect</button>
    </div>

    <div class="status-grid">
      <div class="status-item" id="wsConnection">
        <span class="status-label">WebSocket:</span>
        <span class="status-value" id="wsStatus">Not Connected</span>
      </div>
      <div class="status-item" id="deviceConnection">
        <span class="status-label">Device Hardware:</span>
        <span class="status-value" id="deviceStatus">Unknown</span>
      </div>
      <div class="status-item" id="initialization">
        <span class="status-label">Initialization:</span>
        <span class="status-value" id="initStatus">Not Initialized</span>
      </div>
      <div class="status-item" id="calibration">
        <span class="status-label">Calibration:</span>
        <span class="status-value" id="calibrationStatus">Not Calibrated</span>
      </div>
      <div class="status-item" id="tracking">
        <span class="status-label">Tracking:</span>
        <span class="status-value" id="trackingStatus">Not Tracking</span>
      </div>
      <div class="status-item" id="camera">
        <span class="status-label">Camera:</span>
        <span class="status-value" id="cameraStatus">Off</span>
      </div>
      <div class="status-item" id="overall">
        <span class="status-label">Overall Status:</span>
        <span class="status-value" id="overallStatus">Disconnected</span>
      </div>
      <div class="status-item" id="readiness">
        <span class="status-label">Ready to Track:</span>
        <span class="status-value" id="readyStatus">No</span>
      </div>
    </div>

    <h3>Status Log</h3>
    <div class="log-output" id="logOutput"></div>
  </div>

  <script type="module">
    import { createEyeTracker, DeviceStatus } from '../dist/eye-tracking-core.esm.js'
    
    const eyeTracker = createEyeTracker({
      wsUrl: 'ws://127.0.0.1:9000',
      autoInitialize: false, // Manual initialization for demo
      debug: true
    })
    
    const log = (message) => {
      const logOutput = document.getElementById('logOutput')
      const timestamp = new Date().toLocaleTimeString()
      logOutput.innerHTML += `[${timestamp}] ${message}\n`
      logOutput.scrollTop = logOutput.scrollHeight
    }
    
    const updateStatus = () => {
      // Update individual status checks
      const isConnected = eyeTracker.isConnected()
      const isDeviceConnected = eyeTracker.isDeviceConnected()
      const isInitialized = eyeTracker.isDeviceInitialized()
      const isCalibrating = eyeTracker.isCalibrationInProgress()
      const isCalibrated = eyeTracker.isCalibrationComplete()
      const isTracking = eyeTracker.isTrackingActive()
      const isReady = eyeTracker.isReady()
      const isCameraEnabled = eyeTracker.isCameraEnabled()
      const overallStatus = eyeTracker.getStatus()
      
      // Update UI
      document.getElementById('wsStatus').textContent = isConnected ? 'Connected' : 'Not Connected'
      document.getElementById('wsConnection').className = `status-item ${isConnected ? 'active' : ''}`
      
      document.getElementById('deviceStatus').textContent = isDeviceConnected ? 'Connected' : 'Not Connected'
      document.getElementById('deviceConnection').className = `status-item ${isDeviceConnected ? 'active' : 'error'}`
      
      document.getElementById('initStatus').textContent = isInitialized ? 'Initialized' : 'Not Initialized'
      document.getElementById('initialization').className = `status-item ${isInitialized ? 'active' : ''}`
      
      document.getElementById('calibrationStatus').textContent = 
        isCalibrating ? 'In Progress' : (isCalibrated ? 'Complete' : 'Not Calibrated')
      document.getElementById('calibration').className = 
        `status-item ${isCalibrated ? 'active' : (isCalibrating ? 'warning' : '')}`
      
      document.getElementById('trackingStatus').textContent = isTracking ? 'Active' : 'Inactive'
      document.getElementById('tracking').className = `status-item ${isTracking ? 'active' : ''}`
      
      document.getElementById('cameraStatus').textContent = isCameraEnabled ? 'On' : 'Off'
      document.getElementById('camera').className = `status-item ${isCameraEnabled ? 'active' : ''}`
      
      document.getElementById('overallStatus').textContent = overallStatus
      document.getElementById('overall').className = 
        `status-item ${overallStatus === DeviceStatus.TRACKING ? 'active' : ''}`
      
      document.getElementById('readyStatus').textContent = isReady ? 'Yes' : 'No'
      document.getElementById('readiness').className = `status-item ${isReady ? 'active' : ''}`
      
      // Update button states
      document.getElementById('connectBtn').disabled = isConnected
      document.getElementById('initDeviceBtn').disabled = !isConnected || isInitialized
      document.getElementById('initLightBtn').disabled = !isConnected || !isInitialized
      document.getElementById('startCameraBtn').disabled = !isConnected || !isInitialized || isCameraEnabled
      document.getElementById('calibrateBtn').disabled = !isConnected || !isInitialized || isCalibrating
      document.getElementById('disconnectBtn').disabled = !isConnected
    }
    
    // Set up event listeners
    eyeTracker.on('connected', () => {
      log('Connected to eye tracker')
      updateStatus()
    })
    
    eyeTracker.on('disconnected', () => {
      log('Disconnected from eye tracker')
      updateStatus()
    })
    
    eyeTracker.on('statusChanged', (status) => {
      log(`Status changed to: ${status}`)
      updateStatus()
    })
    
    eyeTracker.on('ready', () => {
      log('Device ready')
      updateStatus()
    })
    
    eyeTracker.on('error', (error) => {
      log(`Error: ${error.message}`)
      updateStatus()
    })
    
    eyeTracker.on('calibrationStarted', (data) => {
      log(`Calibration started with ${data.points} points`)
      updateStatus()
    })
    
    eyeTracker.on('calibrationProgress', (data) => {
      log(`Calibration progress: ${data.current}/${data.total}`)
      updateStatus()
    })
    
    eyeTracker.on('calibrationComplete', (result) => {
      log(`Calibration complete: ${result.success ? 'Success' : 'Failed'}`)
      updateStatus()
    })
    
    eyeTracker.on('cameraStarted', () => {
      log('Camera started')
      updateStatus()
    })
    
    eyeTracker.on('cameraStopped', () => {
      log('Camera stopped')
      updateStatus()
    })
    
    // Button handlers
    document.getElementById('connectBtn').addEventListener('click', async () => {
      try {
        log('Connecting...')
        await eyeTracker.connect()
      } catch (error) {
        log(`Connection failed: ${error.message}`)
      }
    })
    
    document.getElementById('initDeviceBtn').addEventListener('click', () => {
      log('Initializing device...')
      eyeTracker.initDevice(false) // Don't request fullscreen for demo
      setTimeout(updateStatus, 500)
    })
    
    document.getElementById('initLightBtn').addEventListener('click', () => {
      log('Initializing IR light...')
      eyeTracker.initLight()
      setTimeout(updateStatus, 500)
    })
    
    document.getElementById('startCameraBtn').addEventListener('click', () => {
      log('Starting camera...')
      eyeTracker.initCamera()
    })
    
    document.getElementById('calibrateBtn').addEventListener('click', () => {
      log('Starting calibration...')
      eyeTracker.startCalibration()
    })
    
    document.getElementById('detailsBtn').addEventListener('click', () => {
      const details = eyeTracker.getDetailedStatus()
      log('Detailed Status:')
      log(JSON.stringify(details, null, 2))
    })
    
    document.getElementById('disconnectBtn').addEventListener('click', () => {
      log('Disconnecting...')
      eyeTracker.disconnect()
    })
    
    // Initial status update
    updateStatus()
    
    // Periodic status update
    setInterval(updateStatus, 1000)
  </script>
</body>
</html>